<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.timetable.mapper.SysUserMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.app.timetable.entity.SysUser">
        <id column="id" property="id" />
        <result column="username" property="username" />
        <result column="name" property="name" />
        <result column="account" property="account" />
        <result column="open_id" property="openId" />
        <result column="phone" property="phone" />
        <result column="img_url" property="imgUrl" />
        <result column="photo_url" property="photoUrl" />
        <result column="gender" property="gender" />
        <result column="access_token" property="accessToken" />
        <result column="user_type" property="userType" />
        <result column="create_time" property="createTime" />
        <result column="description" property="description" />
        <result column="score" property="score"/>
    </resultMap>

    <resultMap id="ListResultMap" type="com.app.timetable.dto.SysUserDTO">
        <id column="id" property="id" />
        <result column="account" property="account" />
        <result column="username" property="username" />
        <result column="name" property="name" />
        <result column="phone" property="phone" />
        <result column="img_url" property="imgUrl" />
        <result column="photo_url" property="photoUrl" />
        <result column="user_type" property="userType" />
    </resultMap>

    <select id="selectPage" resultMap="ListResultMap" parameterType="com.app.timetable.entity.SysUser">
        SELECT * FROM sys_user
        <where>
            1=1
            <if test="user.userType != null">
                AND user_type = #{user.userType, jdbcType=INTEGER}
            </if>
        </where>
        ORDER BY score DESC
    </select>

    <select id="selectByOpenId" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT * FROM sys_user WHERE open_id = #{openId}
    </select>

    <select id="selectMyStudents" resultMap="ListResultMap" parameterType="java.lang.String">
        SELECT DISTINCT u.* FROM sys_user u
        LEFT JOIN student_purchased_course spc ON spc.student_id = u.id
        WHERE spc.teacher_id=#{teacherId}
    </select>
</mapper>
